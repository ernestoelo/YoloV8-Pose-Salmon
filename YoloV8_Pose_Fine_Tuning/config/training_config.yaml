# ================================================================================
# CONFIGURACIÓN DE ENTRENAMIENTO - YOLO POSE ESTIMATION PARA SALMONES SUBACUÁTICOS
# ================================================================================
# Este archivo controla TODOS los aspectos del entrenamiento de fine-tuning.
# Las técnicas de augmentación están especializadas para ambiente submarino.
# ================================================================================

model:
  # Modelo base pre-entrenado de YOLO (cambiar entre v8 y v11 según el proyecto)
  base_model: "yolov8s-pose.pt"  # Cambiar a "yolov11s-pose.pt" en el proyecto de v11
  
  # Tamaño de imagen de entrada
  # - 640px: Buen equilibrio entre velocidad y precisión  
  # - 960px: Alta resolución para máxima precisión de keypoints en peces pequeños
  # - Trade-off: Menos velocidad en inferencia, más memoria de VRAM requerida
  # - Para Jetson posterior, experimental con 640px
  input_size: 960

# ================================================================================
# CONFIGURACIÓN DEL ENTRENAMIENTO
# ================================================================================
training:
  epochs: 300                     # Número total de iteraciones sobre el dataset
  batch_size: -1                  # -1 = autodetectar según VRAM disponible
  patience: 50                    # Early stopping si no hay mejora en 50 épocas
  device: 0                       # GPU 0 (cambiar si tienes múltiples GPUs)
  workers: 8                      # Threads para carga de datos (8 es un buen default)

# ================================================================================
# PONDERACIÓN DE LA FUNCIÓN DE PÉRDIDA (LOSS WEIGHTS)
# ================================================================================
# Controla qué tan importante es cada componente de la pérdida.
# Valores más altos = el modelo se enfoca más en minimizar esa pérdida.
# ================================================================================
loss_weights:
  box: 7.5          # Localización de la bounding box. 7.5 = importante, pero no crítico
  cls: 0.5          # Clasificación (detectar que es un "salmón"). Bajo porque hay 1 clase
  dfl: 1.5          # Distribution Focal Loss (distribución de confianza)
  pose: 12.0        # ★ CRÍTICO: Precisión de los keypoints. VALOR MÁS ALTO.
  kobj: 2.0         # Confianza de keypoint. Moderado para estabilidad

# ================================================================================
# TÉCNICAS DE AUGMENTACIÓN (AUMENTO DE DATOS)
# ================================================================================
# Estas transformaciones se aplican aleatoriamente durante cada época.
# Son CRÍTICAS para evitar overfitting y mejorar robustez.
# Las técnicas aquí están optimizadas para ambientes SUBACUÁTICOS.
# ================================================================================

augmentation:
  
  # --- TRANSFORMACIONES GEOMÉTRICAS ESTÁNDAR ---
  # Estas ayudan al modelo a ser invariante a cambios de escala y orientación.
  
  degrees: 15
    # Rotación de la imagen en ±15 grados.
    # Aplicacion: En video submarino, los peces pueden aparecer a diferentes ángulos.
    # Esto simula rotaciones naturales sin que sea poco realista.
    # Original: 0 (sin rotación) → Cambio a 15 para mayor robustez subacuática.
  
  translate: 0.15
    # Desplazamiento horizontal/vertical (proporción del ancho/alto de la imagen).
    # Aplicación:Simula peces en diferentes posiciones dentro del frame.
    # Valor de 0.15 = desplazamiento hasta 15% del ancho/alto.
    # Original: 0.1 → Cambio a 0.15 para mayor variabilidad.
  
  scale: 0.5
    # Cambio de escala: la imagen se amplía/reduce entre [1-scale, 1+scale].
    # Aplicacion: Simula peces a diferentes distancias de la cámara.
    # Valor de 0.5 = zoom entre 50% y 150% del tamaño original.
    # Importante para robustez en condiciones reales.
  
  shear: 0.0
    # Distorsión de corte (sesgo) de la imagen en ±shear grados.
    # Aplicacion: No se usa (0.0) porque en video submarino es poco realista.
  
  perspective: 0.0
    # Distorsión de perspectiva 3D simulada.
    # Aplicacion: No se usa (0.0) porque mantendríamos invarianza de profundidad.
  
  flipud: 0.0
    # Volteo vertical (arriba-abajo).
    # Aplicacion: NUNCA se activa (0.0) porque los peces no nadan boca abajo.
  
  fliplr: 0.5
    # Volteo horizontal (izquierda-derecha).
    # Aplicacion: Probabilidad 50% de espejo horizontal.
    # Motivo: Los peces pueden nadar en ambas direcciones de forma natural.
  
  mosaic: 1.0
    # Técnica de composición: 4 imágenes se mezclan en 1 mosaico.
    # Aplicacion: Aumenta la diversidad sin requerir más datos.
    # Valor 1.0 = aplicar en 100% de los batches. Muy recomendado.
  
  # --- TRANSFORMACIONES DE COLOR (ESPECÍFICAS PARA AMBIENTE SUBMARINO) ---
  # En el agua, la luz se comporta diferente a tierra: hay atenuación y color-casting.
  
  hsv_h: 0.015
    # Variación de matiz (Hue) en el espacio HSV.
    # Rango: ±0.015 (muy ligero).
    # Aplicacion: Simula cambios sutiles en el espectro de luz bajo el agua.
    # El agua absorbe las longitudes de onda roja (de ahí que todo se ve azulado).
    # Este valor tan pequeño respeta esa realidad.
    # Original: 0.015 → Se mantiene. Está bien calibrado.
  
  hsv_s: 0.7
    # Variación de saturación (Saturation) en el espacio HSV.
    # Rango: ±0.7 (bastante alto).
    # Aplicacion: En el agua, los colores pierden saturación con la profundidad.
    # La turbidez desatura aún más. Valor 0.7 simula esto bien.
    # Original: 0.7 → Se mantiene. Crítico para ambiente submarino.
  
  hsv_v: 0.4
    # Variación de valor (Value/Brightness) en el espacio HSV.
    # Rango: ±0.4 (moderado).
    # Aplicacion: Simula la variabilidad de iluminación submarina.
    # Causas: movimiento del agua, reflejos de la superficie, fuentes de luz artificial.
    # Original: 0.4 → Se mantiene. Buen equilibrio.

# ================================================================================
# VALIDACIÓN
# ================================================================================
validation:
  conf_threshold: 0.25      # Umbral de confianza mínimo para detectar un objeto
  iou_threshold: 0.45       # Umbral de IoU para NMS (Non-Maximum Suppression)
  max_detections: 100       # Máximo número de detecciones por imagen

# ================================================================================
# RUTAS (PATHS)
# ================================================================================
paths:
  data_yaml: "data/data.yaml"           # Ubicación del archivo descriptor del dataset
  output_dir: "outputs/runs"             # Carpeta para guardar logs y modelos
  checkpoint_dir: "outputs/checkpoints"  # Carpeta para guardar checkpoints intermedios

# ================================================================================
# RESUMEN DE CAMBIOS PARA AMBIENTE SUBMARINO
# ================================================================================
# Cambios respecto a la configuración original:
#
# 1. degrees: 0 → 15          (Permitir rotaciones naturales de peces)
# 2. translate: 0.1 → 0.15    (Mayor variabilidad de posición)
#
# Estas técnicas permiten que el modelo sea robusto a:
# - Variaciones naturales de iluminación submarina
# - Orientaciones naturales de peces
#
# ================================================================================
